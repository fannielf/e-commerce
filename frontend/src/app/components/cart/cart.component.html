<div class="container mt-4" *ngIf="cart && cart.items.length > 0; else emptyCart">
  <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
    <h2 class="mb-0">My Cart</h2>

    <div class="cart-timer" [class.cart-timer--warn]="isExpiringSoon">
      On hold for:
      <span class="cart-timer__time">{{ timeLeftText }}</span>
    </div>
  </div>

  <!-- Cart items -->
  <div class="card mb-3" *ngFor="let item of cart.items">
    <div class="card-body d-flex align-items-center justify-content-between gap-3">
      <!-- Left: Product name -->
      <div class="flex-grow-1">
        <h5 class="mb-1">{{ item.productName || 'Unnamed product' }}</h5>
      </div>

      <!-- Right: Controls -->
      <div class="d-flex align-items-center justify-content-end gap-3 flex-wrap">
        <!-- Quantity -->
        <div class="d-flex align-items-center gap-2">
          <label class="me-1 mb-0">Qty</label>

          <button
            class="btn btn-outline-secondary btn-sm"
            (click)="updateQuantity(item, item.quantity - 1)"
            [disabled]="item.quantity <= 1 || item.updating"
          >
            <span *ngIf="!item.updating">âˆ’</span>
            <span *ngIf="item.updating" class="spinner-border spinner-border-sm"></span>
          </button>

          <input
            type="text"
            class="form-control text-center"
            style="width: 60px"
            [value]="item.quantity"
            readonly
          />

          <button
            class="btn btn-outline-secondary btn-sm"
            (click)="updateQuantity(item, item.quantity + 1)"
            [disabled]="item.updating"
          >
            <span *ngIf="!item.updating">+</span>
            <span *ngIf="item.updating" class="spinner-border spinner-border-sm"></span>
          </button>
        </div>

        <!-- Price -->
        <div class="fw-bold text-end" style="min-width: 110px;">
          {{ (item.price * item.quantity) | currency:'EUR' }}
        </div>

        <!-- Remove -->
        <button
          class="btn btn-outline-danger btn-sm"
          (click)="removeItem(item)"
          [disabled]="item.updating"
          aria-label="Remove item"
        >
          âœ•
        </button>
      </div>
    </div>
  </div>

  <!-- Cart summary -->
  <div class="card p-3">
    <div class="d-flex justify-content-between fs-5">
      <span>Total</span>
      <strong>{{ cart.totalPrice | currency:'EUR' }}</strong>
    </div>

    <button class="btn btn-success mt-3 w-100" (click)="proceedToCheckout()">
      Proceed to Checkout
    </button>
  </div>
</div>

<!-- Empty cart -->
<ng-template #emptyCart>
  <div class="text-center mt-5 text-muted">
    <h4>Your cart is empty ðŸ›’</h4>
    <p>Add some products to continue.</p>
  </div>
</ng-template>

<div class="container mt-4">
  <h1 class="mb-4">My Dashboard</h1>

  <!-- Loading and Error States -->
  <div *ngIf="isLoading" class="text-center">
    <p>Loading your dashboard...</p>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && !errorMessage && dashboardData">
    <!-- Summary Section -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card text-white mb-3 dashboard-bg">
          <div class="card-header">Total Spent</div>
          <div class="card-body">
            <h4 class="card-title">{{ dashboardData.total | currency:'EUR' }}</h4>
          </div>
        </div>
      </div>
    </div>

    <!-- Most Bought and Recent Orders Section -->
    <div class="row">
      <div class="col-lg-4 mb-4">
        <h2>Most Bought Items</h2>
        <div *ngIf="dashboardData.topItems.length > 0; else noTopItems">
          <ul class="list-group">
            <li *ngFor="let item of dashboardData.topItems" class="list-group-item d-flex justify-content-between align-items-center clickable-list-item" (click)="goToProduct(item.productId)">
              {{ item.productName }}
              <span class="badge rounded-pill dashboard-bg">{{ item.quantity }} bought</span>
            </li>
          </ul>
        </div>
        <ng-template #noTopItems>
          <p>No purchase data available.</p>
        </ng-template>
      </div>

      <div class="col-lg-8">
        <h2>Recent Orders</h2>

        <!-- Filter Controls -->
        <div class="row g-3 align-items-center mb-3">
          <div class="col-auto">
            <label for="statusFilter" class="col-form-label">Status</label>
          </div>
          <div class="col-auto">
            <select id="statusFilter" class="form-select" [(ngModel)]="statusFilter" (ngModelChange)="applyFilters()">
              <option value="">All</option>
              <option *ngFor="let status of orderStatuses" [value]="status">{{ status }}</option>
            </select>
          </div>
          <div class="col-auto">
            <label for="dateFilter" class="col-form-label">Date</label>
          </div>
          <div class="col-auto">
            <input type="date" id="dateFilter" class="form-control" [(ngModel)]="dateFilter" (ngModelChange)="applyFilters()">
          </div>
          <div class="col-auto">
            <button class="btn btn-secondary" (click)="clearFilters()">Clear</button>
          </div>
        </div>

        <div *ngIf="dashboardData.orders.length > 0; else noOrders" class="card overflow-hidden mb-4">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-striped table-hover mb-0">
                <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th class="text-end">Total</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let order of filteredOrders" (click)="viewOrder(order.orderId)" style="cursor: pointer;">
                  <td>{{ order.orderId }}</td>
                  <td>{{ order.createdAt | date:'mediumDate' }}</td>
                  <td>
                      <span class="badge rounded-pill text-uppercase"
                            [style.background-color]="
                              order.status === 'CREATED' ? 'var(--light-color)' :
                              order.status === 'CONFIRMED' ? 'var(--primary-color)' :
                              order.status === 'SHIPPED' ? 'var(--dark-color)' :
                              order.status === 'DELIVERED' ? 'var(--success-color)' :
                              order.status === 'CANCELLED' ? 'var(--danger-color)' : 'gray'"
                            [style.color]="order.status === 'CREATED' ? 'var(--text-color)' : '#fff'"
                            [style.border]="order.status === 'CREATED' ? '1px solid var(--border-color)' : 'none'">
                        {{ order.status }}
                      </span>
                  </td>
                  <td class="text-end">{{ order.totalPrice | currency:'EUR' }}</td>
                </tr>
                <tr *ngIf="filteredOrders.length === 0">
                  <td colspan="4" class="text-center">No orders match your filter criteria.</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <ng-template #noOrders>
          <p>You have not placed any orders yet.</p>
        </ng-template>
      </div>
    </div>
  </div>
</div>

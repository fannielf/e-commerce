<div class="container mt-4 d-flex justify-content-center" *ngIf="product">
  <div class="card p-4" style="width: 700px;">
    <div class="row g-3">

      <!-- Image Upload Area -->
      <div class="col-md-5 d-flex flex-column align-items-center">
        <!-- Main image preview -->
        <div class="position-relative mb-2">
          <img [src]="imagePreviews.length > 0 ? (imagePreviews[0].isNew ? imagePreviews[0].url : (imagePreviews[0].url | imageUrl)) : 'assets/product_image_placeholder.png'" class="img-fluid" alt="Product Image Preview" style="cursor: pointer; object-fit: cover; width: 250px; height: 250px;" (click)="fileInput.click()">
          <div class="position-absolute top-0 start-0 p-2 text-gray" style="pointer-events: none;">
            <i class="bi bi-images fs-1"></i>
          </div>
        </div>

        <!-- existing images with delete buttons -->
        <div *ngIf="imagePreviews.length > 1" class="d-flex flex-wrap justify-content-center">
          <div *ngFor="let preview of imagePreviews.slice(1); let i = index" class="position-relative m-1">
            <img [src]="preview.isNew ? preview.url : (preview.url | imageUrl)" class="img-thumbnail" alt="Product image {{i + 2}}" style="width: 60px; height: 60px; object-fit: cover;">
            <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0" style="line-height: 0.5; padding: .2rem .4rem;" (click)="removeImagePreview(preview)">
              &times;
            </button>
          </div>
        </div>
        <small class="text-muted mt-1">Click main image to add new images (max 5).</small>
      </div>

      <div class="col-md-7">
        <h3>{{ mode === 'create' ? 'Create Product' : 'Update Product' }}</h3>
        <form (ngSubmit)="submit()">
          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input id="name" class="form-control" [(ngModel)]="product.name" name="name" required>
          </div>

          <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea id="description" class="form-control" [(ngModel)]="product.description" name="description" rows="3" required></textarea>
          </div>

          <div class="mb-3">
            <label for="price" class="form-label">Price (€)</label>
            <input id="price" type="number" class="form-control" [(ngModel)]="product.price" name="price" step="0.01" required>
          </div>

          <div class="mb-3">
            <label for="quantity" class="form-label">Quantity</label>
            <input id="quantity" type="number" class="form-control" [(ngModel)]="product.quantity" name="quantity" required>
          </div>

          <input id="images" type="file" class="d-none" multiple accept="image/*" (change)="onFileSelected($event)" #fileInput>
          <div class="d-flex">
          <button type="submit" class="btn btn-success">
            {{ mode === 'create' ? 'Create Product' : 'Update Product' }}
          </button>
          <button *ngIf="mode === 'update'" type="button" class="btn btn-danger ms-2" (click)="onDelete()">
            Delete Product
          </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="container mt-4" *ngIf="mode === 'update'">
  <button type="button" class="btn btn-success" (click)="switchToCreateMode()">
    Create a new listing
  </button>
</div>

<div class="container mt-5" *ngIf="loading">
  <p>Loading your listings…</p>
</div>

<div class="container mt-5" *ngIf="!loading && sellerProducts.length">
  <h4>Your listings</h4>
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3 mt-2">
    <div class="col" *ngFor="let p of sellerProducts">
      <div class="card h-100 product-card" (click)="edit(p)">
        <img [src]="p.images && p.images.length > 0 ? (p.images[0] | imageUrl) : 'assets/product_image_placeholder.png'"
             class="card-img-top"
             alt="{{p.name}}"
             style="object-fit: cover; height: 180px;">
        <div class="card-img-overlay d-flex justify-content-center align-items-center edit-overlay">
          <span class="text-white fs-4">Edit</span>
        </div>
        <div class="card-body">
          <h5 class="card-title mb-1">{{p.name}}</h5>
          <p class="card-text text-truncate mb-1">{{p.description}}</p>
          <p class="card-text"><strong>€{{p.price}}</strong></p>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="container mt-4 text-muted" *ngIf="!loading && sellerProducts.length === 0">
  <p>No listings yet. Create your first product above.</p>
</div>

<div class="container mt-4 text-danger" *ngIf="error">
  <p>{{error}}</p>
</div>

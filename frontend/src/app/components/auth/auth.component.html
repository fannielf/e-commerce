<div class="container mt-5">

  <div *ngIf="isLogin">
    <h2 class="text-center mb-4">Welcome Back!</h2>
    <p class="text-center mb-4">We're happy to see you again</p>
  </div>
  <div *ngIf="!isLogin">
    <h2 class="text-center mb-4">Welcome!</h2>
    <p class="text-center mb-4">Let's get you started</p>
  </div>
  <!-- Toggle -->
  <div class="d-flex justify-content-center mb-4">
    <div class="toggle-container">
      <div class="toggle-slider" [class.right]="!isLogin"></div>
      <div class="toggle-btn" [class.active]="isLogin" (click)="isLogin = true">Login</div>
      <div class="toggle-btn" [class.active]="!isLogin" (click)="isLogin = false">Signup</div>
    </div>
  </div>

  <!-- Form Wrapper -->
  <div class="row justify-content-center">
    <div class="col-md-6">
      <!-- Login Form -->
      <div *ngIf="isLogin">
        <form [formGroup]="loginForm" (ngSubmit)="onLoginSubmit()">
          <div class="mb-3">
            <input type="email" class="form-control" formControlName="email" placeholder="Enter your email:"
                   [class.is-invalid]="loginForm.get('email')?.invalid && loginForm.get('email')?.value">
            <div *ngIf="loginForm.get('email')?.invalid && loginForm.get('email')?.value" class="invalid-feedback">
              <div *ngIf="loginForm.get('email')?.errors?.['required']">Email is required.</div>
              <div *ngIf="loginForm.get('email')?.errors?.['email']">Please enter a valid email address.</div>
            </div>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" formControlName="password" placeholder="Enter your password:"
                   [class.is-invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.value">
            <div *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.value" class="invalid-feedback">
              <div *ngIf="loginForm.get('password')?.errors?.['required']">Password is required.</div>
              <div *ngIf="loginForm.get('password')?.errors?.['minlength']">Password must be at least 3 characters long.</div>
            </div>
          </div>
          <button class="btn w-100" type="submit" [disabled]="loginForm.invalid">Login</button>
        </form>
      </div>

      <!-- Signup Form -->
      <div *ngIf="!isLogin">
        <form [formGroup]="signupForm" (ngSubmit)="onSignupSubmit()">
          <div class="mb-3">
            <input type="text" class="form-control" formControlName="firstname" placeholder="Enter your first name:"
                   [class.is-invalid]="signupForm.get('firstname')?.invalid && signupForm.get('firstname')?.value">
            <div *ngIf="signupForm.get('firstname')?.invalid && signupForm.get('firstname')?.value" class="invalid-feedback">
              <div *ngIf="signupForm.get('firstname')?.errors?.['required']">First name is required.</div>
              <div *ngIf="signupForm.get('firstname')?.errors?.['minlength']">First name must be at least 2 characters long.</div>
              <div *ngIf="signupForm.get('firstname')?.errors?.['maxlength']">First name cannot be more than 50 characters long.</div>
              <div *ngIf="signupForm.get('firstname')?.errors?.['whitespace']">First name cannot be only whitespace.</div>
            </div>
          </div>
          <div class="mb-3">
            <input type="text" class="form-control" formControlName="lastname" placeholder="Enter your last name:"
                   [class.is-invalid]="signupForm.get('lastname')?.invalid && signupForm.get('lastname')?.value">
            <div *ngIf="signupForm.get('lastname')?.invalid && signupForm.get('lastname')?.value" class="invalid-feedback">
              <div *ngIf="signupForm.get('lastname')?.errors?.['required']">Last name is required.</div>
              <div *ngIf="signupForm.get('lastname')?.errors?.['minlength']">Last name must be at least 2 characters long.</div>
              <div *ngIf="signupForm.get('lastname')?.errors?.['maxlength']">Last name cannot be more than 50 characters long.</div>
              <div *ngIf="signupForm.get('lastname')?.errors?.['whitespace']">Last name cannot be only whitespace.</div>
            </div>
          </div>
          <div class="mb-3">
            <input type="email" class="form-control" formControlName="email" placeholder="Enter your email:"
                   [class.is-invalid]="signupForm.get('email')?.invalid && signupForm.get('email')?.value">
            <div *ngIf="signupForm.get('email')?.invalid && signupForm.get('email')?.value" class="invalid-feedback">
              <div *ngIf="signupForm.get('email')?.errors?.['required']">Email is required.</div>
              <div *ngIf="signupForm.get('email')?.errors?.['pattern']">Please enter a valid email address.</div>
            </div>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" formControlName="password" placeholder="Enter your password:"
                   [class.is-invalid]="signupForm.get('password')?.invalid && signupForm.get('password')?.value">
            <div *ngIf="signupForm.get('password')?.invalid && signupForm.get('password')?.value" class="invalid-feedback">
              <div *ngIf="signupForm.get('password')?.errors?.['required']">Password is required.</div>
              <div *ngIf="signupForm.get('password')?.errors?.['minlength']">Password must be at least 3 characters long.</div>
            </div>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" formControlName="confirmPassword" placeholder="Confirm your password:"
                   [class.is-invalid]="(signupForm.get('confirmPassword')?.invalid && signupForm.get('confirmPassword')?.value) || (signupForm.errors?.['passwordsMismatch'] && signupForm.get('confirmPassword')?.value)">
            <div *ngIf="(signupForm.get('confirmPassword')?.invalid && signupForm.get('confirmPassword')?.value) || (signupForm.errors?.['passwordsMismatch'] && signupForm.get('confirmPassword')?.value)" class="invalid-feedback">
              <div *ngIf="signupForm.get('confirmPassword')?.errors?.['required']">Password confirmation is required.</div>
              <div *ngIf="signupForm.errors?.['passwordsMismatch']">Passwords do not match.</div>
            </div>
          </div>

          <div class="mb-3 d-flex">
            <div class="form-check me-3">
              <input class="form-check-input"
                     type="radio"
                     id="roleClient"
                     value="CLIENT"
                     formControlName="role">
              <label class="form-check-label" for="roleClient">Client</label>
            </div>
            <div class="form-check">
              <input class="form-check-input"
                     type="radio"
                     id="roleSeller"
                     value="SELLER"
                     formControlName="role">
              <label class="form-check-label" for="roleSeller">Seller</label>
            </div>
          </div>

          <!-- Avatar input only when SELLER -->
          <div class="mb-3" *ngIf="signupForm.get('role')?.value === 'SELLER'">
            <input #avatarInput
                   type="file"
                   class="form-control"
                   (change)="onAvatarSelected($event)"
                   accept="image/*"
                   [class.is-invalid]="avatarError">
            <small class="text-muted">Add an optional avatar (max 2MB)</small>
            <div *ngIf="avatarError" class="invalid-feedback d-block">
              {{ avatarError }}
            </div>
          </div>

          <button class="btn w-100" type="submit" [disabled]="signupForm.invalid">Signup</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="container mt-5">

  <!-- Search and Sort Section -->
  <div class="card bg-transparent mb-5 p-4">
    <!-- Search and Sort -->
    <div class="row g-4 align-items-center">
      <!-- Search Input -->
      <div class="col-md-8">
        <label for="searchInput" class="form-label visually-hidden">Search products</label>
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            id="searchInput"
            placeholder="Search for products..."
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()">
          <button class="btn btn-success" type="button" (click)="onSearch()">
            Search
          </button>
        </div>
      </div>

      <!-- Sort Dropdown -->
      <div class="col-md-4">
        <div class="d-flex align-items-center">
          <label for="sortBySelect" class="me-2 text-nowrap">Sort by:</label>
          <select class="form-select" id="sortBySelect" [(ngModel)]="sortBy" (ngModelChange)="onSortChange()">
            <option value="latest">Latest</option>
            <option value="price_asc">Price: Ascending</option>
            <option value="price_desc">Price: Descending</option>
            <option value="alpha_asc">Alphabetical: A-Z</option>
            <option value="alpha_desc">Alphabetical: Z-A</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Filtering (Category and Price Inputs) -->
    <div class="row g-4 align-items-center mt-1">
      <!-- Category Select -->
      <div class="col-md-4">
        <select class="form-select" id="categorySelect" [(ngModel)]="selectedCategory" (ngModelChange)="onFilterChange()" aria-label="Filter by Category">
          <option value="">All Categories</option>
          <option *ngFor="let cat of categories" [value]="cat">
            {{ cat | titlecase }}
          </option>
        </select>
      </div>

      <!-- Price Inputs -->
      <div class="col-md-8">
        <div class="row g-2">
          <!-- Min Price -->
          <div class="col-6">
            <div class="input-group">
              <span class="input-group-text bg-white">Min €</span>
              <input
                type="number"
                class="form-control"
                placeholder="0"
                min="0"
                oninput="validity.valid||(value='');"
                (keydown.minus)="$event.preventDefault()"
                [(ngModel)]="minPrice"
                (change)="onFilterChange()"
                aria-label="Minimum Price">
            </div>
          </div>
          <!-- Max Price -->
          <div class="col-6">
            <div class="input-group">
              <span class="input-group-text bg-white">Max €</span>
              <input
                type="number"
                class="form-control"
                placeholder="Any"
                min="0"
                oninput="validity.valid||(value='');"
                (keydown.minus)="$event.preventDefault()"
                [(ngModel)]="maxPrice"
                (change)="onFilterChange()"
                aria-label="Maximum Price">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <h2 class="mb-4">For sale</h2>

  <div *ngIf="products.length === 0" class="text-center">
    <p class="mb-0">No products match your search criteria.</p>
  </div>

  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
    <div class="col" *ngFor="let product of products">
      <div class="product-card-uniform" [ngClass]="{'sold-out-card': product.quantity === 0}" (click)="goToProduct(product.productId)" style="cursor: pointer;">
        <div class="card-img-container">
          <app-image-carousel [images]="product.images || []"></app-image-carousel>
        </div>
        <div class="card-body">
          <h5 class="card-title text-truncate">{{ product.name }}</h5>
          <div class="card-text price-container">
            <ng-container *ngIf="product.quantity > 0; else soldOutPrice">
              {{ product.price | currency:'EUR':'symbol' }}
            </ng-container>
            <ng-template #soldOutPrice>
              <span class="original-price-strikethrough">{{ product.price | currency:'EUR':'symbol' }}</span>
              <span class="sold-out-label">Sold Out</span>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Pagination Controls -->
  <div *ngIf="products.length > 0 && totalPages > 1" class="d-flex justify-content-center align-items-center mt-5 mb-5 pb-5 gap-3">

    <!-- Previous Arrow -->
    <button
      class="btn p-0 border-0 bg-transparent text-dark"
      [disabled]="currentPage === 0"
      (click)="onPageChange(currentPage - 1)"
      [style.opacity]="currentPage === 0 ? '0' : '1'"
      style="font-size: 1.2rem; line-height: 1;">
      &larr;
    </button>

    <!-- Page Numbers -->
    <div class="d-flex gap-3">
      <span
        *ngFor="let page of pagesArray"
        (click)="onPageChange(page)"
        [style.cursor]="'pointer'"
        [class.fw-bold]="page === currentPage"
        [class.text-decoration-underline]="page === currentPage"
        [class.text-muted]="page !== currentPage">
        {{ page + 1 }}
      </span>
    </div>

    <!-- Next Arrow -->
    <button
      class="btn p-0 border-0 bg-transparent text-dark"
      [disabled]="currentPage >= totalPages - 1"
      (click)="onPageChange(currentPage + 1)"
      [style.opacity]="currentPage >= totalPages - 1 ? '0' : '1'"
      style="font-size: 1.2rem; line-height: 1;">
      &rarr;
    </button>

  </div>
</div>
